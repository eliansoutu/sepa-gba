---
css: "styles.css"
format:
  closeread-html:
    embed-resources: true
---

```{r warning=F, echo=F, message=F, results='hide'}
library(tidyverse)
library(sf)
library(ggiraph)
library(comunicacion)

data <- read_sf("insumos/data_resumen.gpkg")
total <- read_sf("insumos/total.gpkg")
cba <- read_rds("insumos/productos_gba.rds")
marcas <- read_rds("insumos/data_marcas.rds")
marcas_cat <- read_rds("insumos/marcas_categoria.rds")
sucursales <- read_sf("insumos/sucursales.geojson")
tabla_productos <- read_rds("insumos/tabla_productos.rds")

girafe_f <- function(plot){
  girafe(ggobj = plot,
  width_svg = 7,
  height_svg = 6,
  bg = "transparent",
  options = list(
  opts_toolbar(
  hidden = c("lasso_select", "lasso_deselect", "zoom_onoff",
  "zoom_rect", "zoom_reset", "saveaspng"
  )
  ),
  opts_sizing(rescale = F),
  opts_tooltip(use_fill = F),
  opts_hover(css = "stroke:black;stroke-width:1px;")
))
}

knitr::opts_chunk$set(echo = FALSE, warning = FALSE, message = FALSE)
```

A continuación se analiza el precio de un conjunto de productos alimenticios en el Gran Buenos Aires, a partir de datos de [Precios Claros del Sistema Electrónico de Publicidad de Precios Argentinos (SEPA)](https://www.preciosclaros.gob.ar/){target="_blank"} publicados por la Secretaría de Industria y Comercio del Ministerio de Economía, para el mes de julio de 2025.

```{r}
mapa <- total %>% 
  ggplot() +
  geom_sf_interactive(aes(fill = valor_cba,
 tooltip = paste(nomdepto_censo, "\n", lbl_money(valor_cba, decimales = 0)),                           data_id = nomdepto_censo)) +
  scale_fill_viridis_c() +
  theme_void() + labs(fill = "Costo de cubrir productos \nde la CBA (en pesos)",
                      caption = "Nota: valores calculados en base a la mediana")
  #theme(legend.position = "bottom")

```


::::{.cr-section}

:::{focus-on="cr-canasta"}

## ¿Cómo nos alimentamos?

El SEPA está integrado por una amplia diversidad de productos y sus precios, declarados por comercios de todo el país. 

<br>

A fines de este análisis se identificaron aquellos productos que se asimilan a las categorías que conforman la [Canasta Básica Alimentaria (CBA)](https://www.indec.gob.ar/indec/web/Nivel4-Tema-4-43-149){target="_blank"} elaborada por el INDEC para el Gran Buenos Aires (GBA).
:::

::: {#cr-canasta}
```{r out.width="140%"}
knitr::include_graphics("insumos/canasta.png")
```
::: 

::::

::::{.cr-section}

La CBA es una medida que representa los hábitos de consumo y las necesidades kilocalóricas y proteicas imprescindibles de una persona, tomando como referencia un varón adulto de entre 30 y 60 años, de actividad moderada, durante un mes. <br>  <br> **Es utilizada para la medición de la pobreza extrema en Argentina**. [@cr-cba]

En este sentido, vemos que productos como **la leche, el pan, la papa, la carne, las frutas y las hortalizas** tienen un peso importante en la alimentación de los argentinos. [@cr-cba-hl]

::: {#cr-cba}
```{r}
circles <- cba[[2]] %>% 
  ggplot() +
  geom_polygon_interactive(aes(x, y, group = id, tooltip = cba[[1]]$text[id],data_id = id),
fill = "#0097b2") +
  geom_text(data = cba[[1]], aes(x, y, label = str_wrap(gsub("Group_", "", producto), 10), size = value), color="white") +
  coord_equal() +
  theme_void() +
  theme(legend.position="none", plot.margin=unit(c(0,0,0,0),"cm"))

girafe_f(circles)
```
:::

::: {#cr-cba-hl}
```{r}
highlight <- c("Leche","Carnes","Papa","Pan","Hortalizas","Frutas")

circles <- cba[[2]] %>% 
  ggplot() +
  geom_polygon_interactive(aes(x, y, group = id, tooltip = cba[[1]]$text[id],data_id = id),
fill = ifelse(cba[[2]]$id %in% c(1,7,12,13,14,18), "#d6ed64", "grey")) +
  geom_text(data = cba[[1]] %>% filter(producto %in% highlight), aes(x, y, label = gsub("Group_", "", producto)), size=5, color="black", fontface = "bold") +
  coord_equal() +
  theme_void() +
  theme(legend.position="none", plot.margin=unit(c(0,0,0,0),"cm"))

girafe_f(circles)
```
:::

::::


::::{.cr-section}

:::{focus-on="cr-cba-mes"}

## ¿Cuánto cuesta alimentarse?

Los datos del SEPA permiten conocer los precios de productos que integran las categorías de la CBA y, por ende, cúanto dinero destinamos a cubrir nuestras necesidades alimenticias.

<br>

<p style="font-size: medium;">**Todos los valores corresponden a julio de 2025**.
</p>

:::


:::{focus-on="cr-cba-mes"}

Cabe mencionar que estos datos difieren de los publicados por INDEC para el cálculo de la inflación, en tanto se utilizan otras fuentes de datos y criterios para su medición (ver [metodología](metodologia.qmd)).

<br>

Por ejemplo, por falta de representatividad en la base del SEPA, se excluyeron los siguientes productos que integran la CBA: menudencias, otras harinas (maíz), huevos y azúcar.

:::

:::{#cr-cba-mes}
```{r}
data_cba_cat <- data %>% 
st_drop_geometry() %>% 
summarise(valor_cba = mean(valor_cba), .by = categoria) %>% 
mutate(categoria = fct_reorder(categoria, valor_cba))

person <- png::readPNG("insumos/adulto.png")

plot_cba_cat <- data_cba_cat %>% 
ggplot() +
geom_col_interactive(aes(categoria, valor_cba, tooltip = paste(lbl_money(valor_cba))), fill = "navy") +
annotation_raster_interactive(person, xmin = .7, xmax = 6,
ymin = 50000, ymax = 64000, tooltip = "¡Hola! Soy un varón de entre 30 y 60 años y estos son mis <br>consumos alimenticios mensuales aproximados.") +
coord_flip() +
theme_minimal() +
labs(x = "", y = "Monto destinado a cubrir productos de la CBA (en pesos)", caption = "Nota: valores calculados en base a la mediana")

girafe_f(plot_cba_cat)
```

:::

::::

::::{.cr-section}

:::{focus-on="cr-cba-hogares"}

**¿Y cuánto le cuesta a una familia alimentarse?** 

<br>

Tomando como referencia la composición de los hogares realizada por INDEC, podemos ver el costo de cubrir buena parte de la CBA según precios del SEPA, para distintos hogares.

:::

```{r include=FALSE}
data_hogar <- total %>%
st_drop_geometry() %>%
summarise(adulto = mean(valor_cba)) %>%
mutate("Hogar1" = adulto*2.46,
       "Hogar2" = adulto*3.09,
       "Hogar3" = adulto*3.25)
```

Un **adulto** equivalente (varón de entre 30 y 60 años) requirió, aproximadamente, **`r lbl_money(data_hogar$adulto)`** pesos en julio de 2025 para alimentarse. [@cr-cba-hogares]{scale-by="2.5" pan-to="60%,60%"}

Un hogar de **tres integrantes**, compuesto por una mujer de 35 años, su hijo de 18 años y su madre de 61 años, necesitó **`r lbl_money(data_hogar$Hogar1)`**. [@cr-cba-hogares]{scale-by="2" pan-to="-50%,50%"}

Mientras que un hogar de **cuatro integrantes**, compuesto por un varón de 35 años, una mujer de 31 años, un hijo de 6 años y una hija de 8 años: **`r lbl_money(data_hogar$Hogar2)`**. [@cr-cba-hogares]{scale-by="2" pan-to="50%,-50%"}

Por último, uno de **cinco integrantes**, constituido por un varón y una mujer, ambos de 30 años, y tres hijos de 1, 3 y 5 años, requirió **`r lbl_money(data_hogar$Hogar3)`**. [@cr-cba-hogares]{scale-by="2" pan-to="-50%,-50%"}

:::{#cr-cba-hogares}
```{r}
knitr::include_graphics("insumos/hogares.png")
```
:::

::::

::::{.cr-section}

:::{focus-on="cr-mapa"}

## ¿Dónde es más caro/barato alimentarse?

Los datos del SEPA permiten analizar la distribución territorial de los precios a lo largo y ancho del GBA.

<br>

<p style="font-size: medium;">*Información correspondiente a un adulto equivalente*.
</p>
:::

:::{#cr-mapa}
```{r}
girafe_f(mapa)
```
:::


**`r str_to_title(slice_max(total, valor_cba, n = 1)$nomdepto_censo)` arrojó el mayor valor** de acuerdo a los precios relevados, seguido de los partidos de Vicente López y Tigre. [@cr-top]{scale-by="5" pan-to="10%,100%"}


Mientras que **`r str_to_title(slice_min(total, valor_cba, n = 1)$nomdepto_censo)` registró el menor valor**, con una diferencia de `r comunicacion::lbl_money(round(slice_max(total, valor_cba, n = 1)$valor_cba) - round(slice_min(total, valor_cba, n = 1)$valor_cba))` pesos respecto `r str_to_title(slice_max(total, valor_cba, n = 1)$nomdepto_censo)`. [@cr-top]{scale-by="4" pan-to="100%,-40%"}


:::{focus-on="cr-top"}

Es decir, que en este partido cubrir las necesidades alimentarias es casi un 20% más barato que en el partido más caro. 

<br>

<p style="font-size: medium;">*Cabe destacar que Marcos Paz es una zona más despoblada y, por ende, con menor cantidad de comercios.*
</p>
:::

:::{#cr-top}
```{r}
girafe_f(mapa + geom_sf_label_interactive(data = slice_max(total, valor_cba, n = 1),
aes(label = paste(nomdepto_censo, comunicacion::lbl_money(valor_cba))), 
hjust = -.5, vjust = -.7,size = 1.5) + geom_sf_label_interactive(data = slice_min(total, valor_cba, n = 1), hjust = 1.2, vjust = 5,
aes(label = paste(nomdepto_censo, comunicacion::lbl_money(valor_cba))), size = 1.5))

```
:::

::::

::::{.cr-section}

:::{focus-on="cr-productos-max"}

```{r include=FALSE}
productos <- data %>% st_drop_geometry() %>%  summarise(precio = mean(precio_unificado), .by = categoria)
```

## ¿Cuánto me sale cada producto?

El <b style = "color: #d6ed64;">café</b> es el producto más caro de los analizados (si bien su peso en la alimentación es bajo), por amplia diferencia. Un kilo de café ronda los <b style = "color: #d6ed64;">`r lbl_money(productos$precio[productos$categoria=="Café"])` pesos</b>.

:::

Por su parte, el producto más barato de la CBA es la <b style = "color: #d6ed64;">papa: `r lbl_money(productos$precio[productos$categoria=="Papa"])` pesos</b> por kilo. Le siguen, muy de cerca, la **harina** (`r lbl_money(productos$precio[productos$categoria=="Harina de trigo"])`) y la **batata** (`r lbl_money(productos$precio[productos$categoria=="Batata"])`). [@cr-productos-min]

:::{#cr-productos-max}
```{r}
plot_productos <- productos %>% 
mutate(categoria = fct_reorder(categoria, precio)) %>% 
ggplot() +
geom_col_interactive(aes(categoria, precio, tooltip = paste(lbl_money(precio),
ifelse(str_detect(categoria, "Bebidas"), "pesos por lt", "pesos por kg"))), fill = ifelse(productos$categoria == "Café", "#d6ed64", "navy")) +
coord_flip() +
theme_minimal() +
labs(x = "", y = "Precio por kg/lt", caption = "Nota: valores calculados en base a la mediana")

girafe_f(plot_productos)
```
:::


:::{#cr-productos-min}
```{r}
plot_productos <- productos %>% 
mutate(categoria = fct_reorder(categoria, precio)) %>% 
ggplot() +
geom_col_interactive(aes(categoria, precio, tooltip = paste(lbl_money(precio),
ifelse(str_detect(categoria, "Bebidas"), "pesos por lt", "pesos por kg"))), fill = ifelse(productos$categoria == "Papa", "#d6ed64", "navy")) +
coord_flip() +
theme_minimal() +
labs(x = "", y = "Precio por kg/lt", caption = "Nota: valores calculados en base a la mediana")

girafe_f(plot_productos)
```
:::

::::

::::{.cr-section}

Veamos la distribución de precios de las categorías de productos. [@cr-boxplot]

:::{#cr-boxplot}
```{r}
data_tooltip <- tabla_productos %>% 
                 summarise(min = min(precio_unificado),
                           median = median(precio_unificado),
                           max = max(precio_unificado), .by = categoria)

tabla_productos <- tabla_productos %>% 
 left_join(data_tooltip) %>%  mutate(categoria = fct_relevel(categoria, sort(unique(tabla_productos$categoria), decreasing = T)))

boxplot <- tabla_productos %>% 
  ggplot() + 
  geom_boxplot_interactive(aes(categoria, precio_unificado,
tooltip = paste(categoria, "\nPrecio mínimo:", lbl_money(min),
                "\nMediana:",lbl_money(median),
                 "\nPrecio máximo:", lbl_money(max)))) +
  theme_minimal() +
  coord_flip() +
  labs(x = "", y = "Precio x kg/lt (en pesos)")


girafe_f(boxplot)
```
:::

::::

::::{.cr-section}

El <b style = "color: #d6ed64;">café</b> presenta el mayor rango de precios. [@cr-boxplot-zoom]{scale-by="2" pan-to="-40%,55%"}

Con algunos productos que presentan precios particularmente elevados. [@cr-boxplot-zoom]{scale-by="5" pan-to="-220%,130%"}

:::{#cr-boxplot-zoom}
```{r}
dato_max <- tabla_productos %>% filter(productos_descripcion == "Café NESCAFE DOLCA Original x50g FCO-50-gr.")

boxplot <- tabla_productos %>% 
  ggplot() + 
  geom_boxplot_interactive(aes(categoria, precio_unificado,
tooltip = paste(categoria, "\nPrecio mínimo:", lbl_money(min),
                "\nMediana:",lbl_money(median),
                 "\nPrecio máximo:", lbl_money(max)),
 fill = categoria), show.legend = F) +
geom_point_interactive(data = dato_max, aes(categoria, precio_unificado, tooltip = "Soy un café caro"), color = "#d6ed64", size = 3) +
scale_fill_manual(values = c("Café"="#d6ed64")) +
  theme_minimal() +
  coord_flip() +
  labs(x = "", y = "Precio x kg/lt (en pesos)")


girafe_f(boxplot)
```
:::

::::

::::{.cr-section}


Otras categorías, como el <b style = "color: #d6ed64;">fiambre</b>, el <b style = "color: #d6ed64;">queso</b>, la <b style = "color: #d6ed64;">leche</b> y la <b style = "color: #d6ed64;">sal fina</b>, también muestran un rango de precios amplio, justificado en la existencia de productos de distinta calidad y/o presentación. [@cr-boxplot-all]

Por ejemplo, dentro de la leche podemos encontrar un sachet de 1 litro de una marca propia de un supermercado, en el extremo inferior, y una leche en polvo infantil fortificada, en el extremo superior. [@cr-boxplot-all]{scale-by="4" pan-to="40%,-70%"}


:::{#cr-boxplot-all}
```{r}
boxplot <- tabla_productos %>% 
  ggplot() + 
  geom_boxplot_interactive(aes(categoria, precio_unificado, fill = categoria,
tooltip = paste(categoria, "\nPrecio mínimo:", lbl_money(min),
                "\nMediana:",lbl_money(median),
                 "\nPrecio máximo:", lbl_money(max)))) +
scale_fill_manual(values = c("Leche"="#d6ed64",
"Fiambres"="#d6ed64",
"Queso"="#d6ed64",
"Sal fina"="#d6ed64")) +
  theme_minimal() +
  coord_flip() +
  labs(x = "", y = "Precio x kg/lt (en pesos)")


girafe_f(boxplot)
```
:::

::::

::::{.cr-section}

:::{focus-on="cr-sucursales"}

## ¿Dónde compramos?

Por su parte, el acceso a productos, y por ende, a precios variados, puede diferir según el lugar de residencia. El SEPA contempla comercios grandes, con varias sucursales, pero con una **presencia desigual en el territorio**, brindando mayores posibilidades de acceso a productos diversos en barrios porteños.

:::

La concentración de sucursales es notoria en barrios de la ciudad, con respecto a la provincia. [@cr-sucursales]{scale-by="5" pan-to="-40%,50%"}


:::{#cr-sucursales}
```{r}
mapa_sucursales <- sucursales %>% 
  ggplot() +
geom_sf(data = total, fill = "#0097b2") +
  geom_sf_interactive(aes(tooltip = paste(sucursales_tipo)), color = "white", alpha = .5, size = .02) +
  theme_void() 


girafe_f(mapa_sucursales)
```
:::

::::

::::{.cr-section}

:::{focus-on="cr-marcas"}

## ¿Qué tanto podemos elegir?

A su vez, la oferta de productos de cada categoría es diversa, algo que influye en los precios analizados. A mayor variedad de productos (comercios, marcas, presentaciones), mayor posibilidad de elegir.

:::


:::{#cr-marcas}
```{r}
marcas_cat <- read_rds("insumos/marcas_categoria.rds")

marcas_circles <- marcas_cat[[2]] %>% 
  ggplot() +
  geom_polygon_interactive(aes(x, y, group = id, tooltip = marcas_cat[[1]]$text[id],data_id = id),
fill = "#0097b2") +
  geom_text(data = marcas_cat[[1]], aes(x, y, label = str_wrap(gsub("Group_", "", categoria), 10)), size=2.5, color="white") +
  coord_equal() +
  theme_void() +
  theme(legend.position="none", plot.margin=unit(c(0,0,0,0),"cm"))

girafe_f(marcas_circles)
```
:::

Categorías de productos como las <b style = "color: #d6ed64;">bebidas alcoholicas</b> encabezan el ranking de cantidad de marcas que integran el SEPA, con 430. Le siguen las <b style = "color: #d6ed64;">galletitas</b> (dulces y saladas) y el <b style = "color: #d6ed64;">queso</b>. [@cr-marcas-hl]

:::{#cr-marcas-hl}
```{r}

marcas_circles_hl <- marcas_cat[[2]] %>% 
  ggplot() +
  geom_polygon_interactive(aes(x, y, group = id, tooltip = marcas_cat[[1]]$text[id],data_id = id),
                         fill = ifelse(marcas_cat[[2]]$id %in% c(12,13,25), "#d6ed64", "grey")) +
  geom_text(data = marcas_cat[[1]], aes(x, y, label = str_wrap(gsub("Group_", "", categoria), 10)), size=2.5, color="white") +
  coord_equal() +
  theme_void() +
  theme(legend.position="none", plot.margin=unit(c(0,0,0,0),"cm"))

girafe_f(marcas_circles_hl)
```
:::

::::

::::{.cr-section}

Veamos las zonas donde hay mayor cantidad de opciones de marcas de productos, de acuerdo a los datos registrados en el SEPA. [@cr-marcas-geo]

:::{focus-on="cr-marcas-geo"}

Las comunas 1 y 14 ofrecen una mayor cantidad de marcas para los productos analizados de la CBA. Les siguen los partidos de Quilmes, Morón y Tigre.

<br>

<p style="font-size: medium;">*Comuna 1: Retiro, San Nicolás, Puerto Madero, San Telmo, Montserrat y Constitución*. <br>*Comuna 14: Palermo*.
</p>

:::

:::{#cr-marcas-geo}
```{r}
mapa_marcas <- marcas[["marcas_barrio"]] %>% 
left_join(total) %>% st_as_sf() %>% 
  ggplot() +
  geom_sf_interactive(aes(fill = marcas,
 tooltip = paste(nomdepto_censo, "\nMarcas:", lbl_int(marcas)),                           data_id = nomdepto_censo)) +
  scale_fill_viridis_c(option = "B", begin = .3) +
  theme_void() + labs(fill = "Cantidad de marcas")


girafe_f(mapa_marcas)
```
:::

::::

::::{.cr-section}

Pongamos el foco en los productos que más pesan en la alimentación, de acuerdo a la CBA, y analicemos la concentración de marcas. [@cr-marcas-top]

**La leche presenta una mayor diversidad de marcas**, justificada en la oferta de productos para distintas edades (bebés, niños, adultos) y formas de presentación (en polvo, líquida). [@cr-marcas-top]{scale-by="3.5" pan-to="110%,-70%"}

La Comuna 1, integrada por los barrios de Retiro, San Nicolás, Puerto Madero, San Telmo, Monserrat y Constitución, presenta una gran cantidad de marcas asociadas a este producto. [@cr-marcas-top]{scale-by="11" pan-to="320%,-150%"}

Vemos una gran diferencia respecto a otros barrios de la ciudad o partidos de la Provincia de Buenos Aires. [@cr-marcas-top]{scale-by="3.5" pan-to="110%,-70%"}

En cambio, **en el resto de los productos con peso en la CBA, no hay una gran diferencia en la presencia de marcas por barrios**. Carnes y frutas rondan entre las 2 y las 12 marcas. [@cr-marcas-top]{scale-by="2" pan-to="40%,60%"}

Mientras que el pan y la papa registran entre 5 y 15 y entre 1 y 7 marcas, respectivamente. [@cr-marcas-top]{scale-by="2" pan-to="-30%,-40%"}
 
:::{#cr-marcas-top}
```{r}
top_marcas <- marcas[["data_marcas"]] %>% 
filter(categoria %in% c("Leche","Pan","Papa","Carnes","Hortalizas","Frutas")) %>% 
left_join(total) %>% st_as_sf()

### ICONOS AD HOC
#leche <- png::readPNG("insumos/ad")

coords_leche <- st_centroid( top_marcas %>% 
filter(categoria == "Leche", nomdepto_censo %in% c("COMUNA 01"))) %>% 
  st_coordinates() %>% as.data.frame()
coords_leche$categoria <- "Leche"
coords_leche$icono <- "insumos/adulto.png"  # ruta al archivo de imagen

mapa_top_marcas <- top_marcas %>% 
  ggplot() +
  geom_sf_interactive(aes(fill = marcas,
 tooltip = paste(nomdepto_censo, "\nMarcas:", lbl_int(marcas), "\nProducto:",categoria),                           data_id = nomdepto_censo), color = "white") +
  ggimage::geom_image(data = coords_leche, aes(x = X, y = Y, image = icono), size = 0.03, color = "#0097b2") +
  scale_fill_viridis_c(option = "B", begin = .3) +
  theme_void() + labs(fill = "Cantidad de marcas") + theme(legend.position ="bottom") +
facet_wrap_interactive(~categoria)


girafe_f(mapa_top_marcas)
```
:::

::::

::::{.cr-section}

Estos datos buscan ser útiles para conocer más sobre cuánto gastan las personas en alimentación y cuáles son las posibilidades de acceder a productos dentro del GBA. [@cr-canasta-end]

**Y vos, ¿sabés cuánto pagás?** [@cr-canasta-end]

:::{#cr-canasta-end}
```{r}
girafe_f(mapa)
```
:::

::::

<br>

<p style="font-size: large; text-align: center;">**¡Gracias por llegar hasta acá! Recordá visitar la [sección metodológica](metodologia.html) para conocer más en detalle del análisis.**</p>

<p style="font-size: large; text-align: center;">**Datos descargados del [portal de datos abiertos del Ministerio de Economía](https://datos.gob.ar/dataset/produccion-precios-claros---base-sepa), publicados por la Dirección de Evaluación y Monitoreo de Precios, Subsecretaría de Defensa del Consumidor y Lealtad Comercial, Secretaría de Industria y Comercio**</p>

